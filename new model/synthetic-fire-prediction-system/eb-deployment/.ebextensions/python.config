option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: application:application
  aws:elasticbeanstalk:application:environment:
    PYTHONPATH: "/var/app/current"
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.small

container_commands:
  01_upgrade_pip:
    command: "pip install --upgrade pip"
  02_install_requirements:
    command: "pip install -r requirements-dashboard.txt"

files:
  "/etc/systemd/system/streamlit.service":
    mode: "000644"
    owner: root
    group: root
    content: |
      [Unit]
      Description=Streamlit Dashboard
      After=network.target

      [Service]
      Type=simple
      User=ec2-user
      WorkingDirectory=/var/app/current
      ExecStart=/var/app/venv/bin/python run_dashboard.py
      Restart=always
      Environment=HOME=/var/app/current

      [Install]
      WantedBy=multi-user.target

commands:
  01_start_streamlit:
    command: "systemctl daemon-reload && systemctl enable streamlit.service && systemctl start streamlit.service"